(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4239],{660:e=>{e.exports={modalOverlay:"BuddyGroupDetailModal_modalOverlay____bbB",modalContainer:"BuddyGroupDetailModal_modalContainer__HmvSb",scrollContainer:"BuddyGroupDetailModal_scrollContainer__xJg0G",closeButton:"BuddyGroupDetailModal_closeButton__DQG9O",closeIcon:"BuddyGroupDetailModal_closeIcon__15dlz",title:"BuddyGroupDetailModal_title__IEdXR",buddyGroupLoadingContainer:"BuddyGroupDetailModal_buddyGroupLoadingContainer__845It",spinner:"BuddyGroupDetailModal_spinner__Bs1Da",spin:"BuddyGroupDetailModal_spin__5yy16",loadingText:"BuddyGroupDetailModal_loadingText__xUruO",errorContainer:"BuddyGroupDetailModal_errorContainer__oZwj1",errorText:"BuddyGroupDetailModal_errorText__LtslI",retryButton:"BuddyGroupDetailModal_retryButton__j4UOx",retryButtonText:"BuddyGroupDetailModal_retryButtonText__Njh3G",detailsContainer:"BuddyGroupDetailModal_detailsContainer__tiiYw",mapContainer:"BuddyGroupDetailModal_mapContainer__JEsaU",map:"BuddyGroupDetailModal_map__yGhxs",mapOverlay:"BuddyGroupDetailModal_mapOverlay__oMARM",mapOverlayText:"BuddyGroupDetailModal_mapOverlayText__EcqMX",headerContainer:"BuddyGroupDetailModal_headerContainer__vxec2",groupImage:"BuddyGroupDetailModal_groupImage___acDI",groupTextContainer:"BuddyGroupDetailModal_groupTextContainer__AqHiv",groupTitle:"BuddyGroupDetailModal_groupTitle__6Wa1f",groupDescription:"BuddyGroupDetailModal_groupDescription__bXxfw",sectionTitle:"BuddyGroupDetailModal_sectionTitle__YQhh2",memberList:"BuddyGroupDetailModal_memberList__Nk43q",memberCard:"BuddyGroupDetailModal_memberCard__i5W_l",memberNickname:"BuddyGroupDetailModal_memberNickname__8Hj5h",goToBuddyPageButton:"BuddyGroupDetailModal_goToBuddyPageButton__KVjav",goToBuddyPageButtonGradient:"BuddyGroupDetailModal_goToBuddyPageButtonGradient__x5cVD",goToBuddyPageTouchable:"BuddyGroupDetailModal_goToBuddyPageTouchable__n9I4C",goToBuddyPageButtonText:"BuddyGroupDetailModal_goToBuddyPageButtonText__IWG2l"}},696:e=>{e.exports={backdrop:"InviteOverlay_backdrop__y90Kw",wrapper:"InviteOverlay_wrapper__b6DHZ",blurLayer:"InviteOverlay_blurLayer__jdiHc",card:"InviteOverlay_card__mfsdM",title:"InviteOverlay_title__wvpMO",list:"InviteOverlay_list__lZ8Vs",empty:"InviteOverlay_empty__71RRe",item:"InviteOverlay_item__K528_",avatar:"InviteOverlay_avatar__qt3ej",name:"InviteOverlay_name__OM9Y2",inviteBtn:"InviteOverlay_inviteBtn__DuI0d",closeBtn:"InviteOverlay_closeBtn__4utFG",devBadge:"InviteOverlay_devBadge__RFjxk"}},10165:e=>{e.exports={wrapper:"MoveQuiz_wrapper__xmCDH",attemptRow:"MoveQuiz_attemptRow__GYL1p",attemptDot:"MoveQuiz_attemptDot__BmieJ",activeDot:"MoveQuiz_activeDot__dnfCz",timer:"MoveQuiz_timer__RpRwi",line:"MoveQuiz_line__FUdLi",suggestionLine:"MoveQuiz_suggestionLine__6cbsK",gap:"MoveQuiz_gap__QReUh",gapSmall:"MoveQuiz_gapSmall__omLKG",gapActive:"MoveQuiz_gapActive__FeBoi",word:"MoveQuiz_word__FXY3S",wordSentence:"MoveQuiz_wordSentence__6Nt08",wordSuggestion:"MoveQuiz_wordSuggestion__9rF1c",dragging:"MoveQuiz_dragging__8z4nT",hintMark:"MoveQuiz_hintMark__NzMqC",btnRow:"MoveQuiz_btnRow__imMzt",hintBtn:"MoveQuiz_hintBtn__vfIrV",checkBtn:"MoveQuiz_checkBtn__R0Ted",reveal:"MoveQuiz_reveal___LT9y",correct:"MoveQuiz_correct__cCr4Y"}},13905:e=>{e.exports={overlay:"GuideOverlay_overlay__EBrXf",svgLayer:"GuideOverlay_svgLayer__is8Yq",backdrop:"GuideOverlay_backdrop__Ew_ae",callout:"GuideOverlay_callout__JfhvZ",title:"GuideOverlay_title__hqH_0",desc:"GuideOverlay_desc__I1BwJ",navRow:"GuideOverlay_navRow__QhU8i",navBtn:"GuideOverlay_navBtn__3Rmxv",disabled:"GuideOverlay_disabled__DZ_eS",skip:"GuideOverlay_skip__ohrNv"}},19089:e=>{e.exports={card:"FillQuiz_card__At68N",attemptRow:"FillQuiz_attemptRow__rSg5E",dot:"FillQuiz_dot__MNbGh",activeDot:"FillQuiz_activeDot__kwHXr",timer:"FillQuiz_timer__mYrxg",sentence:"FillQuiz_sentence__dHu_3",fixed:"FillQuiz_fixed__Sgtg0",blank:"FillQuiz_blank__2eBca",blankActive:"FillQuiz_blankActive__zVNrg",blankWrong:"FillQuiz_blankWrong__ASd7s",filled:"FillQuiz_filled__lj4my",suggestions:"FillQuiz_suggestions__lHfZG",chip:"FillQuiz_chip__fsS7S",btnRow:"FillQuiz_btnRow__uuYvb",hintBtn:"FillQuiz_hintBtn__Ek9n7",checkBtn:"FillQuiz_checkBtn__6wFh7",reveal:"FillQuiz_reveal__GNdBQ"}},29017:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var n=a(95155);a(12115);var s=a(35695),r=a(91218),i=a(89760),l=a(7926),o=a(50246),c=a.n(o);let d=e=>{var t;let{buddyGroupId:a,buddyPhoto:o,buddyPhotoMedium:d,buddyPhotoThumbnail:u,activityCountry:m,size:g}=e,{SERVER_URL:h}=(0,i.U)(),{t:p}=(0,r.Bd)(),_=(0,s.useRouter)(),v=null===(t=l.X.find(e=>e.name===m))||void 0===t?void 0:t.flag;return(0,n.jsxs)("div",{onClick:()=>{_.push("/buddyInfo?buddyGroupId=".concat(a))},className:c().container,style:{width:g,height:g},children:[(0,n.jsx)("img",{src:u||d||o||"/assets/buddyDefault.png",alt:"Profile",className:c().profileImage,style:{width:g,height:g,borderRadius:g/2}}),v&&(0,n.jsx)("div",{className:c().flagWrapper,style:{width:g/3+4,height:g/3+4,borderRadius:g/6+2},children:(0,n.jsx)("img",{src:v,alt:"Flag",className:c().flagImage,style:{width:g/3,height:g/3,borderRadius:g/6}})})]})}},30349:e=>{e.exports={overlay:"CustomScenarioModal_overlay__rrefH",card:"CustomScenarioModal_card__e50vG",image:"CustomScenarioModal_image__lzK7_",gradient:"CustomScenarioModal_gradient__VVGd6",textWrap:"CustomScenarioModal_textWrap__HzYa1",title:"CustomScenarioModal_title__x3h42",scenario:"CustomScenarioModal_scenario__FZ9Pj",personaBox:"CustomScenarioModal_personaBox__gSpu_",personaTrait:"CustomScenarioModal_personaTrait___0KC_",personaCatch:"CustomScenarioModal_personaCatch__a6QiY",btnRow:"CustomScenarioModal_btnRow__zGL3b",btn:"CustomScenarioModal_btn__BYp_m",btnLeave:"CustomScenarioModal_btnLeave__LXSgP",disabled:"CustomScenarioModal_disabled__8dWs2"}},32404:e=>{e.exports={container:"MultipleChoiceOptions_container__iiGl6",headerRow:"MultipleChoiceOptions_headerRow__esD8k",headerText:"MultipleChoiceOptions_headerText__TGRmh",disableBtn:"MultipleChoiceOptions_disableBtn__QhypX",explanation:"MultipleChoiceOptions_explanation__Ed6vc",option:"MultipleChoiceOptions_option__4dhVN",correct:"MultipleChoiceOptions_correct__0XfJR",wrong:"MultipleChoiceOptions_wrong__zN0s_",optionText:"MultipleChoiceOptions_optionText__mOMWl",optionTextSelected:"MultipleChoiceOptions_optionTextSelected__RQYx1",resultIcon:"MultipleChoiceOptions_resultIcon__GRiou",bounce:"MultipleChoiceOptions_bounce__xRBFO",bounceScale:"MultipleChoiceOptions_bounceScale__dsfsR"}},39627:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ef});var n=a(95155),s=a(12115),r=a(66766),i=a(29300),l=a.n(i),o=a(98232),c=a.n(o),d=a(35695),u=a(23464),m=a(14298),g=a(89760),h=a(91218),p=a(31699),_=a(48335);function v(){let e=(0,s.useRef)(null),[t,a]=(0,s.useState)(null),n=(0,s.useRef)(null),r=e=>{null!=n.current&&cancelAnimationFrame(n.current),n.current=requestAnimationFrame(()=>{n.current=null,e()})},i=()=>{let t=e.current;if(!t)return;let n=t.getBoundingClientRect(),s=n.width,r=n.height,i=n.left+s/2+window.scrollX;a({x:i,y:n.top+r/2+window.scrollY,radius:Math.max(s,r)/2+8})};return(0,s.useLayoutEffect)(()=>(r(i),()=>{null!=n.current&&cancelAnimationFrame(n.current)}),[]),(0,s.useEffect)(()=>{let t=e.current;if(!t)return;let a=()=>r(i),n=new ResizeObserver(()=>r(i));return n.observe(t),window.addEventListener("scroll",a,{passive:!0}),window.addEventListener("resize",a),r(i),()=>{n.disconnect(),window.removeEventListener("scroll",a),window.removeEventListener("resize",a)}},[e.current]),[e,t]}var f=a(50507),y=a.n(f);let x=e=>e.trim().split(/\s+/),C=(e,t,a)=>{let n=x(e),s=a?x(a):[],r=(e,t)=>{let a=RegExp("\\b".concat(y()(t),"\\b"),"i").exec(e);if(!a||void 0===a.index)return -1;let n=e.slice(0,a.index).trim();return n?n.split(/\s+/).length:0};return t.map(t=>{if(void 0!==t.index&&t.index>=0)return t;if(t.error.trim()){let a=x(t.error),s=n.findIndex((e,s)=>n.slice(s,s+a.length).join(" ")===t.error);if(s>=0)return{...t,index:s};let i=r(e,t.error);return{...t,index:i}}let a=x(t.suggestion);if(s.length){let e=0,r=0;for(;e<n.length&&r<s.length;){if(n[e]===s[r]){e++,r++;continue}if(s.slice(r,r+a.length).join(" ")===t.suggestion.trim())return{...t,index:e};r++}}return{...t,index:n.length}})},b=(e,t)=>{let a=x(e);return[...t].sort((e,t)=>{var a,n;return(null!==(a=e.index)&&void 0!==a?a:0)-(null!==(n=t.index)&&void 0!==n?n:0)}).forEach(e=>{let{error:t,suggestion:n,index:s=0}=e,r=x(n);if(t.trim()){let e=x(t).length;a.splice(s,e,...r)}else a.splice(s,0,...r)}),a};var j=a(60493),w=a(51012),N=a.n(w),S=a(50802);let B=e=>{let{onSendMessage:t,showPhotoIcon:a=!0,value:i,onChangeText:o,isAIChat:c=!1,isVoiceChatMode:d=!1,onToggleVoiceChatMode:u=()=>{}}=e,{t:m}=(0,h.Bd)(),[g,p]=(0,s.useState)(null),[_,v]=(0,s.useState)(!1),[f,y]=(0,s.useState)(!1),[x,C]=(0,s.useState)(!1),b=(0,s.useRef)(null),j=(0,s.useRef)(null),w=!!localStorage.getItem("token");(0,s.useEffect)(()=>{let e=j.current;if(!e)return;e.style.height="auto";let t=Math.min(e.scrollHeight,240);e.style.height="".concat(t,"px")},[i]);let B=async()=>{if(f)return;if(!w){C(!0);return}let e=i.trim();if(e||g){y(!0);try{await t({text:e,imageUri:g||void 0}),o(""),p(null),v(!1),j.current&&(j.current.style.height="40px")}catch(e){console.error(e)}finally{y(!1)}}};return(0,n.jsxs)(n.Fragment,{children:[x&&(0,n.jsx)(S.A,{visible:!0,onLogin:()=>{C(!1),window.location.href="/sign-in"},onBrowse:()=>C(!1)}),_&&g&&(0,n.jsx)("div",{className:N().previewOverlay,onClick:()=>v(!1),children:(0,n.jsxs)("div",{className:N().previewCard,onClick:e=>e.stopPropagation(),children:[(0,n.jsx)(r.default,{src:g,alt:"preview",fill:!0,style:{objectFit:"cover",borderRadius:10}}),(0,n.jsx)("button",{className:N().previewClose,onClick:()=>{p(null),v(!1)},children:"✕"})]})}),(0,n.jsxs)("div",{className:N().frame,children:[a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("input",{ref:b,type:"file",accept:"image/*",className:N().hiddenFile,onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(p(URL.createObjectURL(a)),v(!0))}}),(0,n.jsx)("button",{className:N().iconBtn,disabled:f,onClick:()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.click()},children:(0,n.jsx)(r.default,{src:"/assets/chatInputImage.png",alt:"img",width:24,height:24})})]}):(0,n.jsx)("div",{className:N().iconPlaceholder}),(0,n.jsx)("textarea",{ref:j,className:N().input,value:i,onChange:e=>o(e.target.value),placeholder:m(w?"messageInput.placeholder":"messageInput.login_required"),onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),B())},disabled:f}),c&&""===i.trim()?(0,n.jsx)("button",{className:N().iconBtn,onClick:u,disabled:f,children:(0,n.jsx)(r.default,{src:d?"/assets/chatInputPlayOn.png":"/assets/chatInputPlay.png",alt:"voice",width:24,height:24})}):(0,n.jsx)("button",{className:l()(N().iconBtn,{[N().sending]:f}),onClick:B,disabled:f,children:(0,n.jsx)(r.default,{src:"/assets/chatInputSend.png",alt:"send",width:24,height:24})})]})]})};var k=a(32649),I=a(660),R=a.n(I);let A=e=>{let{visible:t,onClose:a,buddyGroupId:r}=e,{SERVER_URL:i}=(0,g.U)(),{t:l}=(0,h.Bd)(),o=(0,d.useRouter)(),[c,m]=(0,s.useState)(!1),[p,_]=(0,s.useState)(null),[v,f]=(0,s.useState)(null),y=e=>e?e.startsWith("http")?e:"/assets/".concat(e):null;return((0,s.useEffect)(()=>{(async()=>{if(r&&t){m(!0),f(null);try{let e=(await u.A.get("".concat(i,"/buddy-groups/get/").concat(r))).data;if(!e)throw Error(l("modal.dataNotFoundError"));_({buddyGroupId:e.buddyGroupId,buddyGroupName:e.buddyGroupName,buddyPhoto:y(e.buddyPhoto),buddyPhotoMedium:y(e.buddyPhotoMedium),description:e.description,activityCountry:e.activityCountry,activityCity:e.activityCity,latitude:e.latitude,longitude:e.longitude,members:e.members.map(e=>({...e,profileImage:y(e.profileImage)}))})}catch(e){console.error(l("modal.unknownError"),e),f(e.message||l("modal.errorFetchingInfo"))}finally{m(!1)}}})()},[r,t,i,l]),t)?(0,n.jsx)("div",{className:R().modalOverlay,onClick:a,children:(0,n.jsx)("div",{className:R().modalContainer,onClick:e=>e.stopPropagation(),children:c?(0,n.jsxs)("div",{className:R().buddyGroupLoadingContainer,children:[(0,n.jsx)("div",{className:R().spinner}),(0,n.jsx)("p",{className:R().loadingText,children:l("modal.loadingBuddyInfo")})]}):v?(0,n.jsxs)("div",{className:R().errorContainer,children:[(0,n.jsx)("p",{className:R().errorText,children:v}),(0,n.jsx)("button",{className:R().retryButton,onClick:async()=>{_(null),m(!0);try{let e=(await u.A.get("".concat(i,"/buddy-groups/get/").concat(r))).data;_({buddyGroupId:e.buddyGroupId,buddyGroupName:e.buddyGroupName,buddyPhoto:y(e.buddyPhoto),buddyPhotoMedium:y(e.buddyPhotoMedium),description:e.description,activityCountry:e.activityCountry,activityCity:e.activityCity,latitude:e.latitude,longitude:e.longitude,members:e.members.map(e=>({...e,profileImage:y(e.profileImage)}))}),f(null)}catch(e){console.error(l("modal.unknownError"),e),f(e.message||l("modal.errorFetchingInfo"))}finally{m(!1)}},children:l("modal.retry")})]}):(0,n.jsxs)("div",{className:R().detailsContainer,children:[(0,n.jsxs)("div",{className:R().mapContainer,children:[(0,n.jsx)("div",{className:R().map,children:p&&p.latitude&&p.longitude&&(0,n.jsx)("img",{src:"/assets/map_buddy.png",alt:"map marker",className:R().customMarkerImage})}),(0,n.jsx)("div",{className:R().mapOverlay,children:(0,n.jsx)("p",{className:R().mapOverlayText,children:"".concat((null==p?void 0:p.activityCity)||l("modal.unknownCity"),", ").concat((null==p?void 0:p.activityCountry)||l("modal.unknownCountry"))})})]}),(0,n.jsxs)("div",{className:R().headerContainer,children:[(0,n.jsx)("img",{src:(null==p?void 0:p.buddyPhotoMedium)?p.buddyPhotoMedium:(null==p?void 0:p.buddyPhoto)?p.buddyPhoto:"/assets/groupChat.png",alt:"group",className:R().groupImage}),(0,n.jsxs)("div",{className:R().groupTextContainer,children:[(0,n.jsx)("p",{className:R().groupTitle,children:null==p?void 0:p.buddyGroupName}),(0,n.jsx)("p",{className:R().groupDescription,children:(null==p?void 0:p.description)||l("modal.defaultDescription")})]})]}),(0,n.jsx)("p",{className:R().sectionTitle,children:l("modal.members")}),(0,n.jsx)("div",{className:R().memberList,children:null==p?void 0:p.members.map(e=>(0,n.jsxs)("div",{className:R().memberCard,children:[(0,n.jsx)(k.A,{userId:e.userId,nickname:e.nickname,profileImage:e.profileImage||void 0,countryName:void 0,size:60}),(0,n.jsx)("p",{className:R().memberNickname,children:e.nickname})]},e.userId))}),(0,n.jsx)("div",{className:R().goToBuddyPageButton,children:(0,n.jsx)("div",{className:R().goToBuddyPageButtonGradient,children:(0,n.jsx)("button",{className:R().goToBuddyPageTouchable,onClick:()=>{p?(a(),o.push("/buddy?buddyGroupId=".concat(p.buddyGroupId))):alert("".concat(l("modal.errorAlert"),": ").concat(l("modal.buddyInfoUnavailable")))},children:(0,n.jsx)("p",{className:R().goToBuddyPageButtonText,children:l("modal.navigateToBuddyPage")})})})})]})})}):null};var M=a(696),D=a.n(M);let G=e=>{let{visible:t,friends:a,chatUserIds:s,onInvite:i,onClose:l,underDevelopment:o}=e,{t:c}=(0,h.Bd)();if(!t)return null;let d=a.filter(e=>!s.includes(e.userId));return(0,n.jsx)("div",{className:D().backdrop,onClick:l,children:(0,n.jsxs)("div",{className:D().wrapper,onClick:e=>e.stopPropagation(),children:[o&&(0,n.jsx)("div",{className:D().blurLayer}),(0,n.jsxs)("div",{className:D().card,children:[(0,n.jsx)("h3",{className:D().title,children:c("invite_friends")}),(0,n.jsxs)("div",{className:D().list,children:[0===d.length&&(0,n.jsx)("p",{className:D().empty,children:c("no_friends_left")}),d.map(e=>(0,n.jsxs)("div",{className:D().item,children:[(0,n.jsx)(r.default,{src:e.profileThumbnail||e.profileImage||"/assets/Anonymous.png",alt:e.nickname,width:40,height:40,className:D().avatar}),(0,n.jsx)("span",{className:D().name,children:e.nickname}),(0,n.jsx)("button",{className:D().inviteBtn,onClick:()=>i(e.userId),children:c("invite")})]},e.userId))]}),(0,n.jsx)("button",{className:D().closeBtn,onClick:l,children:c("close")})]}),o&&(0,n.jsx)("div",{className:D().devBadge,children:c("under_development")})]})})};var O=a(10351),T=a(32404),z=a.n(T);let E=e=>{let{choices:t,onSelect:a,onDisable:r,onClose:i}=e,{t:o}=(0,h.Bd)(),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),g=e=>{c||(d(e.text),m(!0),a(e),setTimeout(()=>{i()},3600))};return(0,s.useEffect)(()=>{if(!u)return;let e=setTimeout(()=>m(!1),240);return()=>clearTimeout(e)},[u]),(0,n.jsxs)("div",{className:z().container,children:[(0,n.jsxs)("div",{className:z().headerRow,children:[(0,n.jsx)("span",{className:z().headerText,children:o("mcq_prompt","Pick the grammatically correct sentence")}),(0,n.jsx)("button",{className:z().disableBtn,onClick:r,children:o("disable_quiz","Turn off")})]}),t.map((e,t)=>{let a=c===e.text,r=a&&e.isCorrect,i=a&&!e.isCorrect;return(0,n.jsxs)(s.Fragment,{children:[i&&e.explanation&&(0,n.jsx)("p",{className:z().explanation,children:e.explanation}),(0,n.jsxs)("button",{className:l()(z().option,a&&(r?z().correct:z().wrong),a&&u&&z().bounce),disabled:!!c,onClick:()=>g(e),children:[(0,n.jsx)("span",{className:l()(z().optionText,a&&z().optionTextSelected),children:e.text}),a&&(0,n.jsx)("span",{className:z().resultIcon,children:r?(0,n.jsx)(O.YrT,{size:18,color:"#31A24C"}):(0,n.jsx)(O.yGN,{size:18,color:"#D8315B"})})]})]},"opt-".concat(t))})]})};var P=a(47937),F=a(62108),Q=a(88440),L=a.n(Q);let U=e=>e.replace(/[_-]+/g," ").replace(/\w+/g,e=>e[0].toUpperCase()+e.slice(1)).replace(/\s+/g,""),q=e=>{let{count:t,accent:a="#6366F1",icon:r="bookmark",size:i=28}=e,[l,o]=(0,s.useState)(!1),c=(0,s.useRef)(t);(0,s.useEffect)(()=>{if(t>c.current){o(!0);let e=setTimeout(()=>o(!1),600);return()=>clearTimeout(e)}c.current=t},[t]);let d=P[U(r)]||F.A;return(0,n.jsxs)("span",{className:"".concat(L().container," ").concat(l?L().pulse:""),style:{height:i,paddingLeft:.5*i,paddingRight:.5*i,borderRadius:i/2,color:a,boxShadow:"0 2px 4px ".concat(a,"33")},children:[(0,n.jsx)(d,{size:.55*i,color:a,style:{marginRight:6,flexShrink:0}}),(0,n.jsx)("span",{className:L().count,style:{fontSize:.5*i+2,color:a},children:t})]})};var W=a(47650),H=a(13905),J=a.n(H);let Y=e=>{var t;let{visible:a,steps:r,storageKey:i,onClose:o,onStepChange:c}=e,{t:d}=(0,h.Bd)(),u="hidden"===localStorage.getItem(i);if(!a||u||!r.length)return null;let[m,g]=(0,s.useState)(0);(0,s.useEffect)(()=>{null==c||c(m)},[m,c]);let p=(0,s.useCallback)(()=>{localStorage.setItem(i,"hidden"),o()},[o,i]),_=r[m],{innerWidth:v,innerHeight:f}=null!==(t=globalThis.window)&&void 0!==t?t:{innerWidth:0,innerHeight:0},y=_.target.y+_.target.radius+106,x=_.target.y-_.target.radius-150,C=y+150+106>f?Math.max(x,106):y,b="undefined"!=typeof document?document.getElementById("__next"):void 0;return b?(0,W.createPortal)((0,n.jsxs)("div",{className:J().overlay,children:[(0,n.jsxs)("svg",{className:J().svgLayer,width:v,height:f,"aria-hidden":!0,focusable:"false",children:[(0,n.jsx)("defs",{children:(0,n.jsxs)("mask",{id:"guide-mask",children:[(0,n.jsx)("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),(0,n.jsx)("circle",{cx:_.target.x,cy:c?106+_.target.radius:_.target.y,r:_.target.radius,fill:"black"})]})}),(0,n.jsx)("rect",{className:J().backdrop,x:"0",y:"0",width:"100%",height:"100%",mask:"url(#guide-mask)"})]}),(0,n.jsxs)("div",{className:J().callout,style:{top:C},children:[(0,n.jsx)("h3",{className:J().title,children:d("".concat(_.key,".title"))}),(0,n.jsx)("p",{className:J().desc,children:d("".concat(_.key,".desc"))}),(0,n.jsxs)("div",{className:J().navRow,children:[(0,n.jsx)("button",{className:l()(J().navBtn,0===m&&J().disabled),disabled:0===m,onClick:()=>g(e=>Math.max(0,e-1)),children:d("guide.prev")}),(0,n.jsx)("button",{className:J().navBtn,onClick:()=>m>=r.length-1?o():g(e=>e+1),children:d(m===r.length-1?"guide.finish":"guide.next")})]}),(0,n.jsx)("button",{className:J().skip,onClick:p,children:d("guide.dontShowAgain")})]})]}),b):null};var X=a(30349),K=a.n(X);let Z=e=>{let{visible:t,imageUri:a,scenarioText:r,persona:i,onClose:o,onLeave:c,onShare:d,chatId:u}=e,{t:m}=(0,h.Bd)();if(!t)return null;let[g,p]=(0,s.useState)(!1),[_,v]=(0,s.useState)(!1),[f,y]=(0,s.useState)(!1);(0,s.useEffect)(()=>{y("true"===localStorage.getItem("shared_chat_".concat(u)))},[u]);let x=async()=>{if(!g){p(!0);try{await c()}finally{p(!1)}}},C=async()=>{if(!_&&!f){v(!0);try{await d(),localStorage.setItem("shared_chat_".concat(u),"true"),y(!0)}catch(e){console.error(e)}finally{v(!1)}}},b="undefined"!=typeof document?document.getElementById("__next"):void 0;return b?(0,W.createPortal)((0,n.jsx)("div",{className:K().overlay,onClick:o,children:(0,n.jsxs)("div",{className:K().card,onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:K().image,style:{backgroundImage:"url(".concat(a,")")},children:[(0,n.jsx)("div",{className:K().gradient}),(0,n.jsxs)("div",{className:K().textWrap,children:[(0,n.jsx)("h3",{className:K().title,children:m("scenario")}),(0,n.jsx)("p",{className:K().scenario,children:r}),i&&(0,n.jsxs)("div",{className:K().personaBox,children:[i.personality&&(0,n.jsx)("p",{className:K().personaTrait,children:i.personality}),i.speakingStyle&&(0,n.jsx)("p",{className:K().personaTrait,children:i.speakingStyle}),i.catchPhrase&&(0,n.jsx)("p",{className:K().personaCatch,children:i.catchPhrase})]})]})]}),(0,n.jsxs)("div",{className:K().btnRow,children:[(0,n.jsx)("button",{className:l()(K().btnLeave,{[K().disabled]:g}),onClick:x,disabled:g,children:m("leave_custom_session")}),f?(0,n.jsx)("button",{className:l()(K().btn,K().disabled),disabled:!0,children:m("shared_label")}):(0,n.jsx)("button",{className:l()(K().btn,{[K().disabled]:_}),onClick:C,disabled:_,children:m("share")})]})]})}),b):null};var V=a(10165),$=a.n(V);let ee=RegExp("\\p{Emoji_Presentation}","gu"),et=e=>e.replace(ee,"").trim()||null,ea=e=>e.split(" ").map(et).filter(e=>!!e),en=e=>"".concat(String(Math.floor(e/60)).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0")),es=e=>{let{sentence:t,issues:a,started:r,learnLanguage:i,onSubmit:o}=e,{t:c}=(0,h.Bd)(),d=ea(t),[u,m]=(0,s.useState)(d),[g,p]=(0,s.useState)([]),[_,v]=(0,s.useState)(null),[f,y]=(0,s.useState)(3),[x,j]=(0,s.useState)(0),[w,N]=(0,s.useState)(new Set),[S,B]=(0,s.useState)(0),[k,I]=(0,s.useState)(null),[R,A]=(0,s.useState)(!1),M=(0,s.useRef)(null);(0,s.useEffect)(()=>{r&&!M.current&&(M.current=Date.now());let e=window.setInterval(()=>{M.current&&B(Math.floor((Date.now()-M.current)/1e3))},1e3);return()=>window.clearInterval(e)},[r]),(0,s.useEffect)(()=>{p(a.flatMap(e=>{let t=ea(e.error);return ea(e.suggestion).filter(e=>!t.includes(e))}))},[a]);let D=(e,t,a)=>JSON.stringify({src:e,idx:t,word:a}),G=(e,t,a)=>n=>{n.dataTransfer.setData("text/plain",D(e,t,a)),n.dataTransfer.effectAllowed="move",v("".concat(e,"-").concat(t,"-").concat(a))},O=()=>v(null),T=(e,t)=>a=>{a.preventDefault();let n=a.dataTransfer.getData("text/plain");if(!n)return;let{src:s,idx:r,word:i}=JSON.parse(n);if(s===e&&r===t)return;let l=[...u],o=[...g];"sentence"===s?l.splice(r,1):o.splice(r,1),"sentence"===e?l.splice(t,0,i):o.splice(t,0,i),m(l),p(o),v(null)},z=e=>e.preventDefault(),E=b(t,C(t,a)),P=(0,s.useCallback)(()=>{let e=new Set;return E.forEach((t,a)=>{u[a]!==t&&e.add(a)}),e},[u,E]),F=e=>{let{w:t,src:a,idx:s}=e;return(0,n.jsxs)("span",{draggable:!0,onDragStart:G(a,s,t),onDragEnd:O,className:l()($().word,{[$().wordSentence]:"sentence"===a,[$().wordSuggestion]:"suggested"===a,[$().dragging]:_==="".concat(a,"-").concat(s,"-").concat(t)}),children:[t,w.has(s)&&"sentence"===a&&(0,n.jsx)("span",{className:$().hintMark,children:"?"})]})};return(0,n.jsxs)("div",{className:$().wrapper,children:[(0,n.jsxs)("div",{className:$().attemptRow,children:[[void 0,void 0,void 0].map((e,t)=>(0,n.jsx)("span",{className:l()($().attemptDot,{[$().activeDot]:t<f})},t)),(0,n.jsx)("span",{className:$().timer,children:en(S)})]}),(0,n.jsxs)("div",{className:$().line,onDragOver:z,children:[u.map((e,t)=>(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)("span",{className:l()($().gap,{[$().gapActive]:_&&_.startsWith("sentence")&&w.has(t)}),onDragOver:z,onDrop:T("sentence",t)}),(0,n.jsx)(F,{w:u[t],src:"sentence",idx:t})]},"gap-s-".concat(t))),(0,n.jsx)("span",{className:$().gap,onDragOver:z,onDrop:T("sentence",u.length)})]}),(0,n.jsxs)("div",{className:$().suggestionLine,onDragOver:z,children:[g.map((e,t)=>(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)("span",{className:$().gapSmall,onDragOver:z,onDrop:T("suggested",t)}),(0,n.jsx)(F,{w:e,src:"suggested",idx:t})]},"gap-t-".concat(t))),(0,n.jsx)("span",{className:$().gapSmall,onDragOver:z,onDrop:T("suggested",g.length)})]}),(0,n.jsxs)("div",{className:$().btnRow,children:[(0,n.jsx)("button",{className:$().hintBtn,onClick:()=>{j(e=>e+1),N(P())},children:c("hint_button")}),(0,n.jsx)("button",{className:$().checkBtn,onClick:()=>{if(f<=0)return;let e=u.join(" "),t=e===E.join(" ");A(t),t?o(e):(alert(c("try_again")),f-1==0&&I(E.join(" "))),y(e=>e-1)},children:c("check_answer_button")})]}),k&&(0,n.jsx)("p",{className:$().reveal,children:c("reveal_answer",{answer:k})}),R&&(0,n.jsx)("p",{className:$().correct,children:c("correct_answer")})]})};var er=a(19089),ei=a.n(er);let el=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),eo=(e,t)=>{let a=e;for(let{error:e,suggestion:n}of t){let t=RegExp(el(e),"g");a=a.replace(t,n)}return a.replace(/\s+/g," ").trim().split(" ")},ec=(e,t)=>{let a=e.trim().split(" "),n=[];t.forEach(e=>{let{suggestion:t}=e;return n.push(...t.trim().split(" "))});let s=[],r=0;for(;r<a.length;){let e=t.find(e=>{let{error:t}=e,n=t.split(" ");return a.slice(r,r+n.length).join(" ").toLowerCase()===t.toLowerCase()});if(e){let t=e.suggestion.trim().split(" ").length;for(let e=0;e<t;e++)s.push("");r+=e.error.trim().split(" ").length}else s.push(a[r]),r+=1}let i=s.map((e,t)=>""===e?t:-1).filter(e=>e>=0);return{initialWords:s,blankIndices:i,suggestionWords:n}},ed=e=>"".concat(String(Math.floor(e/60)).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0")),eu=e=>{let{sentence:t,issues:a,learnLanguage:r,started:i,onSubmit:o}=e,{t:c}=(0,h.Bd)(),{initialWords:d,blankIndices:u,suggestionWords:m}=(0,s.useMemo)(()=>ec(t,a),[t,a]),[g,p]=(0,s.useState)(d),[_,v]=(0,s.useState)(()=>[...m].sort(()=>Math.random()-.5)),[f,y]=(0,s.useState)(3),[x,C]=(0,s.useState)(0),[b,j]=(0,s.useState)(new Set),[w,N]=(0,s.useState)(null),[S,B]=(0,s.useState)(null),k=(0,s.useRef)(null),[I,R]=(0,s.useState)(0);(0,s.useEffect)(()=>{i&&!k.current&&(k.current=Date.now());let e=window.setInterval(()=>{k.current&&R(Math.floor((Date.now()-k.current)/1e3))},1e3);return()=>window.clearInterval(e)},[i]);let A=(e,t)=>JSON.stringify({w:e,idx:t}),M=(e,t)=>a=>{a.dataTransfer.setData("text/plain",A(e,t)),a.dataTransfer.effectAllowed="move"},D=e=>e.preventDefault(),G=e=>t=>{t.preventDefault();let a=t.dataTransfer.getData("text/plain");if(!a)return;let{w:n,idx:s}=JSON.parse(a);g[e]||(p(t=>{let a=[...t];return a[e]=n,a}),v(e=>e.filter((e,t)=>t!==s)),N(null))},O=(e,t)=>{let a=u.find(e=>""===g[e]);void 0!==a&&(p(t=>{let n=[...t];return n[a]=e,n}),v(e=>e.filter((e,a)=>a!==t)))},T=e=>{if(!u.includes(e))return;let t=g[e];t&&(p(t=>{let a=[...t];return a[e]="",a}),v(e=>[...e,t]))},z=(0,s.useMemo)(()=>eo(t,a),[t,a]);return(0,n.jsxs)("div",{className:ei().card,children:[(0,n.jsxs)("div",{className:ei().attemptRow,children:[[void 0,void 0,void 0].map((e,t)=>(0,n.jsx)("span",{className:l()(ei().dot,{[ei().activeDot]:t<f})},t)),(0,n.jsx)("span",{className:ei().timer,children:ed(I)})]}),(0,n.jsx)("div",{className:ei().sentence,children:g.map((e,t)=>u.includes(t)?(0,n.jsx)("div",{className:l()(ei().blank,{[ei().blankActive]:w===t,[ei().blankWrong]:b.has(t)}),onClick:()=>T(t),onDragOver:D,onDragEnter:()=>N(t),onDragLeave:()=>N(null),onDrop:G(t),children:e&&(0,n.jsx)("span",{className:ei().filled,children:e})},"blank-".concat(t)):(0,n.jsx)("span",{className:ei().fixed,children:e},"fixed-".concat(t)))}),(0,n.jsx)("div",{className:ei().suggestions,children:_.map((e,t)=>(0,n.jsx)("span",{draggable:!0,onDragStart:M(e,t),onClick:()=>O(e,t),className:ei().chip,children:e},"sug-".concat(t)))}),(0,n.jsxs)("div",{className:ei().btnRow,children:[(0,n.jsx)("button",{className:ei().hintBtn,onClick:()=>{C(e=>e+1);let e=new Set;u.forEach(t=>{g[t]&&g[t]!==z[t]&&e.add(t)}),j(e)},children:c("hint_button")}),(0,n.jsx)("button",{className:ei().checkBtn,onClick:()=>{let e=g.length===z.length&&g.every((e,t)=>e===z[t]);y(e=>e-1),e?(alert(c("well_done")),o(g.join(" "))):(alert(c("try_again")),f-1==0&&B(z.join(" ")))},children:c("check_answer_button")})]}),S&&(0,n.jsx)("p",{className:ei().reveal,children:c("reveal_answer",{answer:S})})]})};var em=a(29017);let eg=["en","es","fr","zh","ja","ko","ar","de","hi","it","pt","ru"],eh=[{id:"cafe"},{id:"hotel"},{id:"directions"},{id:"grocery"},{id:"clothes"},{id:"interview"},{id:"meeting"},{id:"call"},{id:"hospital"},{id:"emergency"},{id:"dating"},{id:"party"}],ep={en:["Hi there! Who are you and what's happening right now?","Hello! Where am I, and who are you?","Hey! Who are you? What's the situation?"],es:["\xa1Hola! \xbfQui\xe9n eres y qu\xe9 est\xe1 pasando ahora?","\xa1Buenas! \xbfD\xf3nde estoy y qui\xe9n eres t\xfa?","\xa1Hey! \xbfQui\xe9n eres y cu\xe1l es la situaci\xf3n?"],fr:["Salut ! Qui es-tu et que se passe-t-il ?","Bonjour ! O\xf9 suis-je et qui es-tu ?","Coucou ! Qui es-tu ? Quelle est la situation ?"],zh:["你好！你是谁？现在是什么情况？","嗨！我在哪里？你是谁？","嘿！你是谁？发生了什么事？"],ja:["こんにちは！あなたは誰？今はどんな状況？","やあ！ここはどこで、あなたは誰？","ねえ！あなたは誰？今どういう状況？"],ko:["안녕! 넌 누구야? 지금 어떤 상황이야?","안녕하세요! 여기가 어디고 당신은 누구죠?","반가워! 지금 상황이 어떻게 돼?"],ar:["مرحباً! من أنت وما الذي يحدث الآن؟","أهلًا! أين أنا ومن تكون؟","يا هلا! من أنت؟ وما الوضع؟"],de:["Hi! Wer bist du und was passiert gerade?","Hallo! Wo bin ich und wer bist du?","Hey! Wer bist du? Was ist hier los?"],hi:["नमस्ते! आप कौन हैं और अभी क्या हो रहा है?","हैलो! मैं कहाँ हूँ और आप कौन हैं?","अरे! आप कौन हैं? स्थिति क्या है?"],it:["Ciao! Chi sei e cosa sta succedendo adesso?","Salve! Dove sono e chi sei tu?","Ehi! Chi sei? Qual \xe8 la situazione?"],pt:["Oi! Quem \xe9 voc\xea e o que est\xe1 acontecendo agora?","Ol\xe1! Onde estou e quem \xe9 voc\xea?","Ei! Quem \xe9 voc\xea? Qual \xe9 a situa\xe7\xe3o?"],ru:["Привет! Кто ты и что сейчас происходит?","Здравствуйте! Где я и кто вы?","Эй! Кто ты? Какая сейчас ситуация?"]},e_=e=>t=>e("ai-rt.banner.".concat(t));function ev(){var e;let{SERVER_URL:t,FEATURE_UNDER_DEV:a}=(0,g.U)(),{t:i}=(0,h.Bd)(),o=(0,d.useRouter)(),f=(0,d.useSearchParams)(),y=f.get("otherUserId")||void 0,x=f.get("buddyGroupId")||void 0,w=f.get("chatId")||void 0,[N,S]=(0,s.useState)(""),[k,I]=(0,s.useState)(null!=w?w:null),[R,M]=(0,s.useState)(null),[D,O]=(0,s.useState)("friend"),[T,z]=(0,s.useState)(""),[P,F]=(0,s.useState)([]),[Q,L]=(0,s.useState)(!1),[U,W]=(0,s.useState)(!0),[H,J]=(0,s.useState)(null),[X,K]=(0,s.useState)(!1),[V,$]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(!1),[ea,en]=(0,s.useState)(!1),[er,ei]=(0,s.useState)(null),[el,eo]=(0,s.useState)(!1),[ec,ed]=(0,s.useState)(!1),[ev,ef]=(0,s.useState)(!1),[ey,ex]=(0,s.useState)({}),[eC,eb]=(0,s.useState)({}),[ej,ew]=(0,s.useState)(0),[eN,eS]=(0,s.useState)(0),[eB,ek]=(0,s.useState)("B1"),[eI,eR]=(0,s.useState)("none"),[eA,eM]=(0,s.useState)(!1),[eD,eG]=(0,s.useState)(!1),[eO,eT]=(0,s.useState)(!1),[ez,eE]=(0,s.useState)("cafe"),[eP,eF]=(0,s.useState)(null),[eQ,eL]=(0,s.useState)(!0),[eU,eq]=(0,s.useState)(null),[eW,eH]=(0,s.useState)("en"),[eJ,eY]=(0,s.useState)(!1),[eX,eK]=(0,s.useState)(["en"]),[eZ,eV]=(0,s.useState)(!1),[e$,e0]=(0,s.useState)(!0),[e1,e2]=(0,s.useState)(!1),[e3,e6]=(0,s.useState)(0),[e4,e5]=(0,s.useState)(""),e8=!y||"brody-ai"===y||y.startsWith("custom-ai"),e9=!!(null==y?void 0:y.startsWith("custom-ai")),e7=eD&&eO,[te,tt]=(0,s.useState)(null),[ta,tn]=(0,s.useState)(null),[ts,tr]=(0,s.useState)(null),[ti,tl]=(0,s.useState)(null),[to,tc]=(0,s.useState)(!1),[td,tu]=v(),[tm,tg]=v(),[th,tp]=v(),[t_,tv]=v(),[tf,ty]=v(),[tx,tC]=v(),[tb,tj]=v(),[tw,tN]=(0,s.useState)(!1),tS="chatRoomGuide",[tB,tk]=(0,s.useState)(null),[tI,tR]=(0,s.useState)(null),tA=(0,s.useRef)(null),tM=(0,s.useRef)(null),tD=(0,s.useRef)(null),tG=(0,s.useRef)(""),[tO,tT]=(0,s.useState)(""),[tz,tE]=(0,s.useState)([]),[tP,tF]=(0,s.useState)(!1),[tQ,tL]=(0,s.useState)(!1),tU=(0,s.useRef)(!1),[tq,tW]=(0,s.useState)(!1),[tH,tJ]=(0,s.useState)(!1),tY=e=>{try{return window.localStorage.getItem(e)}catch(e){return null}},tX=(e,t)=>{try{window.localStorage.setItem(e,t)}catch(e){}},tK=(0,s.useCallback)(async()=>{try{let a=tY("token");if(!a)return{token:null,userId:null};let n=tY("userId");if(!n){var e;let s=await u.A.get("".concat(t,"/users/me"),{headers:{Authorization:"Bearer ".concat(a)}});(n=null===(e=s.data)||void 0===e?void 0:e.userId)&&tX("userId",n)}return n&&S(n),{token:a,userId:n}}catch(e){return console.error("fetchUserData error",e),{token:null,userId:null}}},[t]),tZ=(0,s.useCallback)(async()=>{let e=tY("token");return e||(ed(!0),null)},[]);(0,s.useEffect)(()=>{let e=new Date().toISOString().slice(0,10),t=tY("smartCountDate"),a=Number(tY("smartCount")||"0");t!==e&&(a=0,tX("smartCountDate",e),tX("smartCount","0")),e6(a),e5(e)},[]);let tV=async()=>{if(!e1&&e3>=30){e2(!1),alert("".concat(i("smart_limit_reached_title"),"\n").concat(i("smart_limit_reached_message")));return}let e=!e1;if(e2(e),e){let e=e3+1;e6(e),tX("smartCount",String(e))}},t$=e=>eg.includes(e);(0,s.useEffect)(()=>{(async()=>{let e=tY("autoCheckLanguage");e&&t$(e)&&(eH(e),p.xC(e)),tW(!0)})()},[]),(0,s.useEffect)(()=>{eW&&(p.xC(eW),tX("autoCheckLanguage",eW))},[eW]),(0,s.useEffect)(()=>{let e=tY("language"),t=tY("learningLanguage"),a=[];if(e&&a.push(e),t)try{let e=JSON.parse(t);Array.isArray(e)&&a.push(...e)}catch(e){}let n=Array.from(new Set(a)).filter(t$),s=Array.from(new Set([...eg.filter(e=>n.includes(e)),...n.filter(e=>!eg.includes(e))]));eK(s.length?s:["en"])},[]),(0,s.useEffect)(()=>{tK()},[tK]),(0,s.useEffect)(()=>{e8&&(async()=>{let e;let{token:a}=await tK();if(!a||k)return;let{data:n}=await u.A.get("".concat(t,"/ai-chat/sessions"),{headers:{Authorization:"Bearer ".concat(a)}}),s=n.sessions||[];(e=y&&"brody-ai"!==y?s.find(e=>e.otherUserId===y):s.find(e=>!e.otherUserId||"brody-ai"===e.otherUserId))||(e={sessionId:(await u.A.post("".concat(t,"/ai-chat/session"),{otherUserId:y||"brody-ai"},{headers:{Authorization:"Bearer ".concat(a)}})).data.sessionId,assistantName:"Brody"}),I(e.sessionId),z(e.assistantName||"Brody (AI)"),O(e.assistantName||"Brody")})()},[t,e8,k,y,tK]),(0,s.useEffect)(()=>{(null==y?void 0:y.startsWith("custom-ai"))&&k&&(async()=>{let{token:e}=await tK();if(e)try{let{rolePlayScenario:a,assistantName:n,situationImage:s,persona:r}=(await u.A.get("".concat(t,"/ai-chat/session/").concat(k,"/metadata"),{headers:{Authorization:"Bearer ".concat(e)}})).data.metadata||{};a&&tt(a),n&&tn(n),s&&tr(s),r&&tl(r)}catch(e){console.error("metadata error",e)}})()},[t,k,y,tK]),(0,s.useEffect)(()=>{(async()=>{var e,a,n,s,r,l;let o=await tZ();if(o&&!e8)try{if(x){let e=(await u.A.get("".concat(t,"/buddy-groups/get/").concat(x),{headers:{Authorization:"Bearer ".concat(o)}})).data;e.buddyPhoto,e.activityCountry;let a=(await u.A.get("".concat(t,"/buddy-chat/").concat(x),{headers:{Authorization:"Bearer ".concat(o)}})).data,n=(a.messages||[]).map(e=>({...e,profileImage:e.profileImage||null}));F(n),I(a.chatId),M(a.chat),K(!1);let s=a.buddyGroupName||"";s&&s!==e.buddyGroupName&&await u.A.post("".concat(t,"/buddy-chat/").concat(x,"/update-name"),{buddyGroupName:e.buddyGroupName},{headers:{Authorization:"Bearer ".concat(o)}}),z(e.buddyGroupName||i("group")),O(e.buddyGroupName||i("group_chat"))}else if(y){let s=(await u.A.post("".concat(t,"/chats/createOrRetrieveChat"),{otherUserId:y},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)}})).data;M(s.chat),z((null===(e=s.chat)||void 0===e?void 0:e.title)||i("group")),(null===(a=s.chat)||void 0===a?void 0:a.messages)&&(null===(n=s.chat)||void 0===n?void 0:n._id)&&(F(s.chat.messages||[]),I(s.chat._id)),O(s.otherUserNickname||y)}}catch(e){if((null==e?void 0:null===(s=e.response)||void 0===s?void 0:s.status)===404&&x){F([]),I(null),M(null),K(!0);try{let e=await tZ();if(!e)return;let a=await u.A.get("".concat(t,"/buddy-groups/get/").concat(x),{headers:{Authorization:"Bearer ".concat(e)}});z((null===(r=a.data)||void 0===r?void 0:r.buddyGroupName)||i("group")),O((null===(l=a.data)||void 0===l?void 0:l.buddyGroupName)||i("group_chat"))}catch(e){z(i("group")),O(i("group_chat"))}return}console.error("loadChat error",e),F([])}})()},[t,i,tZ,e8,x,y]),(0,s.useEffect)(()=>{y&&!e8&&(async()=>{let e=tY("token");if(e)try{let a=await u.A.get("".concat(t,"/users/members/").concat(y),{headers:{Authorization:"Bearer ".concat(e)}});tF(a.data.isBlocked),tL(a.data.isBlockedBy)}catch(e){console.error("block flags error",e)}})()},[t,e8,y]);let t0=e=>({_id:e._id,senderId:"assistant"===e.role?"brody-ai":N,message:e.content,timestamp:e.timestamp,profileImage:"assistant"===e.role?"/AIProfile.png":null,imageUrl:null}),t1=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e8){let{token:a}=await tK();if(!a||!k)return;let n="".concat(t,"/ai-chat/session/").concat(k,"/messages?limit=").concat(20);!e&&H&&(n+="&cursor=".concat(encodeURIComponent(H))),e&&(F([]),J(null)),L(!0);try{let t=await u.A.get(n,{headers:{Authorization:"Bearer ".concat(a)}}),s=(t.data.messages||[]).map(t0);J(t.data.nextCursor||null),W(!!t.data.nextCursor),e?F(s.reverse()):F(e=>[...e,...s.filter(t=>!e.some(e=>e._id===t._id))])}catch(e){console.error("fetch AI msgs error",e)}finally{L(!1)}return}if(!k&&!x)return;let{token:a}=await tK();if(!a)return;let n=x?"".concat(t,"/buddy-chat/").concat(x,"?limit=").concat(20):"".concat(t,"/chats/").concat(k,"/messages?limit=").concat(20);!e&&H&&(n+="&cursor=".concat(encodeURIComponent(H))),e&&(F([]),J(null)),L(!0);try{let t=await u.A.get(n,{headers:{Authorization:"Bearer ".concat(a)}}),s=t.data.messages||[];J(t.data.nextCursor||null),W(!!t.data.nextCursor),e?F(s):F(e=>{let t=s.filter(t=>!e.some(e=>e._id===t._id));return[...e,...t]})}catch(e){console.error("fetch msgs error",e)}finally{L(!1)}},[t,e8,k,x,H,tK]);(0,s.useEffect)(()=>{e8&&k&&N&&t1(!0).then(()=>tJ(!0)).catch(console.error)},[e8,k,N,t1]),(0,s.useEffect)(()=>{!e8&&k&&t1(!0).catch(console.error)},[e8,k,t1]),(0,s.useEffect)(()=>{if(e8&&k&&tH&&tq&&0===P.length&&!tU.current){let e=ep[eW]||ep.en,t=e[Math.floor(Math.random()*e.length)];tU.current=!0,t9({text:t},{skipGrammarCheck:!0}).catch(console.error)}},[e8,k,tH,tq,P.length,eW]),(0,s.useEffect)(()=>{if(!k&&!x)return;let e=(0,m.Ay)(t,{transports:["websocket","polling"]});tA.current=e;let a=null!=x?x:e8?k?"ai:".concat(k):void 0:null!=k?k:void 0;return a&&e.emit("joinRoom",a),e.on("newMessage",e=>{F(t=>e.senderId===N&&t.some(t=>t.senderId===N&&t.message===e.message)||t.some(t=>t._id===e._id)?t:[e,...t])}),e.on("newBuddyMessage",e=>{e._id=String(e._id),F(t=>e.senderId===N&&t.some(t=>t.senderId===N&&t.message===e.message)||t.some(t=>t._id===e._id)?t:[e,...t])}),e8&&k&&(e.on("ai:status",e=>{eq(e_(i)(e.label))}),e.on("ai:done",e=>{eq(null);let t={_id:"ai-".concat(Date.now()),senderId:"brody-ai",message:e.assistantReply||"",timestamp:new Date().toISOString(),profileImage:"/AIProfile.png"};F(e=>[t,...e]),Array.isArray(e.choices)&&e.choices.length&&eF(e.choices),eD&&e.assistantReply&&aa(e.assistantReply)}),e.on("ai:error",()=>{eq("⚠️ Error"),setTimeout(()=>eq(null),1200)})),e.on("connect_error",e=>{e instanceof Error?console.error("socket error",e.message,e):console.error("socket error",e)}),()=>{e.disconnect()}},[t,i,e8,k,x,eD,N]),(0,s.useEffect)(()=>{try{let e=JSON.parse(tY("grammar_history")||"[]"),t=JSON.parse(tY("expression_history")||"[]");ew(Array.isArray(e)?e.length:0),eS(Array.isArray(t)?t.length:0)}catch(e){ew(0),eS(0)}},[]),(0,s.useEffect)(()=>{"hidden"!==tY(tS)&&tN(!0)},[]);let t2=(0,s.useMemo)(()=>[{key:"chatRoomGuide.step1",tgt:tu},{key:"chatRoomGuide.step2",tgt:tg},{key:"chatRoomGuide.step3",tgt:tp},{key:"chatRoomGuide.step4",tgt:tv},{key:"chatRoomGuide.step5",tgt:ty},{key:"chatRoomGuide.step6",tgt:tC},{key:"chatRoomGuide.step7",tgt:tj}].filter(e=>{let{tgt:t}=e;return t&&0!==t.x}).map(e=>{let{key:t,tgt:a}=e;return{key:t,target:a}}),[tu,tg,tp,tv,ty,tC,tj]),t3=(e,t)=>{let a=e.split(/\s+/);return t.map(e=>{if("number"==typeof e.index&&e.index>=0)return e;let t=e.error.split(/\s+/),n=a.findIndex((n,s)=>a.slice(s,s+t.length).join(" ")===e.error);return{...e,index:n}})},t6=(e,t)=>{try{let a=JSON.parse(tY(e)||"[]"),n=Array.isArray(a)?[...a,...t]:t;tX(e,JSON.stringify(n)),"grammar_history"===e&&ew(e=>e+t.length),"expression_history"===e&&eS(e=>e+t.length)}catch(e){console.error("persistHistory error",e)}},t4=async(e,a,n)=>{if(e.trim()&&!eQ){eb(e=>({...e,[a]:!0}));try{let s=tY("token");if(!s)return;let r=tY("language")||"en",i=await fetch("".concat(t,"/api/grammar-check"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({text:e,languageCode:n,uiLanguage:r,smartMode:e1})}),l=await i.json(),o=Array.isArray(l.grammarIssues)?l.grammarIssues.map(t=>({...t,index:"number"==typeof t.index?t.index:e.split(/\s+/).findIndex(e=>e===t.error)})):[],c=Array.isArray(l.expressionIssues)?l.expressionIssues.map(t=>({...t,index:"number"==typeof t.index?t.index:e.split(/\s+/).findIndex(e=>e===t.error)})):[];o=t3(e,o),c=t3(e,c);let d=[...o,...c];ex(e=>({...e,[a]:d}));let u=e.match(/[^\.!\?]+[\.!\?]+/g)||[e],m=new Date().toISOString(),g="true"===(tY("requestScores")||"false"),h=(t,s)=>{let i=[];for(let l=0;l<u.length;l+=2){let o=u.slice(l,l+2).join(" ").trim()||e,c=t.filter(e=>o.includes(e.error)),d=b(o,c).join(" ").trim();c.length>0&&i.push({id:"".concat(a,"-").concat("grammar_history"===s?"g":"e","-").concat(l/2),sentence:o,correctedSentence:d,issues:c,timestamp:m,savedAt:m,requestLanguage:n,uiLanguage:r,requestScores:g})}return i};t6("grammar_history",h(o,"grammar_history")),t6("expression_history",h(c,"expression_history"))}catch(e){console.error("grammar check error",e)}finally{eb(e=>({...e,[a]:!1}))}}},t5=(e,t)=>{let a=e.trim().split(/\s+/),n=t.trim().split(/\s+/),s=0;for(;s<a.length&&s<n.length&&a[s]===n[s];)s++;let r=a.length-1,i=n.length-1;for(;r>=s&&i>=s&&a[r]===n[i];)r--,i--;return{err:a.slice(s,r+1).join(" "),sug:n.slice(s,i+1).join(" ")}},t8=async(e,t,a)=>{try{let{err:n,sug:s}=t5(e,t),r=new Date().toISOString(),i=tY("language")||"en",l={id:"mcq-".concat(Date.now()),sentence:e,correctedSentence:t,issues:[{error:n,suggestion:s,explanation:a,index:-1}],timestamp:r,savedAt:r,requestLanguage:eW,uiLanguage:i,requestScores:!1};t6("grammar_history",[l])}catch(e){console.error("appendWrongMcq error",e)}},t9=(0,s.useCallback)(async function(e){var a,n,s,r;let{text:l,imageUri:o}=e,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};K(!1);let{userId:d}=await tK(),m=await tZ();if(!m)return;if(e1&&e3>=30){e2(!1),alert("".concat(i("smart_limit_reached_title"),"\n").concat(i("smart_limit_reached_message")));return}if(e8){let e=Date.now().toString(),n={_id:e,senderId:null!==(a=null!=d?d:N)&&void 0!==a?a:"unknown",message:l||"",timestamp:new Date().toISOString(),imageUrl:null,isUploading:!0};F(e=>[n,...e]),e$&&(null==l?void 0:l.trim())&&t4(l,e,eW);let s=tY("language")||"en";try{let{assistantReply:a="",choices:n=[]}=(await u.A.post("".concat(t,"/ai-chat/session/").concat(k,"/message"),{content:l,realtimeStatus:!0,difficulty:eB,topic:eI,voiceChatMode:eD,rolePlayScenario:e9?te:eO?ez:null,enableMCQ:eQ,languageCode:eW,uiLanguage:s,smartMode:e1,persona:ti||void 0},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(m)}})).data||{};F(t=>t.map(t=>t._id===e?{...t,isUploading:!1}:t));let r={_id:"ai-".concat(Date.now()),senderId:"brody-ai",message:a,timestamp:new Date().toISOString(),profileImage:"/AIProfile.png"};F(e=>[r,...e]),c.extraIssue&&ex(t=>({...t,[e]:[c.extraIssue]})),Array.isArray(n)&&4===n.length&&eF(n),eD&&a&&aa(a)}catch(t){console.error("AI send error",t),alert(i("message_send_error")),F(t=>t.filter(t=>t._id!==e))}return}let g=Date.now().toString(),h={_id:g,senderId:null!==(n=null!=d?d:N)&&void 0!==n?n:"unknown",message:l||"",timestamp:new Date().toISOString(),imageUrl:o||null,isUploading:!0};F(e=>[h,...e]),e$&&!c.skipGrammarCheck&&(null==l?void 0:l.trim())&&t4(l,g,eW);try{let e=new FormData;if(e.append("senderId",d||""),e.append("timestamp",new Date().toISOString()),l&&e.append("message",l),o){let t=o.split("/").pop()||"photo.jpg";e.append("file",new File([],t))}let a=x?"".concat(t,"/buddy-chat/").concat(x):"".concat(t,"/chats/").concat(k,"/message"),n=await u.A.post(a,e,{headers:{Authorization:"Bearer ".concat(m)}});if(200===n.status||201===n.status){let e=n.data.message,t=null!==(r=e._id)&&void 0!==r?r:e.id;e._id=t?String(t):g,e.isUploading=!1,F(t=>t.map(t=>t._id===g?e:t)),c.extraIssue&&ex(t=>({...t,[e._id]:[c.extraIssue]})),e$&&(null===(s=e.message)||void 0===s?void 0:s.trim())&&t4(e.message,e._id,eW)}else throw Error("unexpected response")}catch(e){console.error("send error",e),F(e=>e.filter(e=>e._id!==g)),alert(i("message_send_error"))}},[t,i,tZ,tK,e8,k,x,eW,eB,eI,eD,eO,ez,te,ti,eQ,e1,e3,e$]),t7=()=>{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return;tM.current&&ae();let t=new e;t.lang=an[eW]||"en-US",t.continuous=!0,t.interimResults=!0,t.onresult=e=>{let t="",a="";for(let n=e.resultIndex;n<e.results.length;n++){let s=e.results[n][0].transcript;e.results[n].isFinal?t+=s:a=s}a&&tT(a),t&&(tG.current=(tG.current+" "+t).trim(),e$&&(tD.current&&clearTimeout(tD.current),tD.current=setTimeout(()=>{at(tG.current),tG.current="",tT("")},1500)))},t.onerror=()=>{ae()},t.onend=()=>{eD&&t7()},tM.current=t,t.start()},ae=()=>{try{var e;null===(e=tM.current)||void 0===e||e.stop()}catch(e){}tM.current=null,tD.current&&(clearTimeout(tD.current),tD.current=null),tT("")},at=async e=>{e.trim()&&await t9({text:e},{skipGrammarCheck:!1})};(0,s.useEffect)(()=>(eD?t7():ae(),()=>ae()),[eD,eW]);let aa=e=>{try{let t=new SpeechSynthesisUtterance(e);t.lang=an[eW]||"en-US",window.speechSynthesis.cancel(),window.speechSynthesis.speak(t)}catch(e){console.warn("TTS unsupported",e)}},an={en:"en-US",es:"es-ES",fr:"fr-FR",zh:"zh-CN",ja:"ja-JP",ko:"ko-KR",ar:"ar-SA",de:"de-DE",hi:"hi-IN",it:"it-IT",pt:"pt-PT",ru:"ru-RU"},as=(e,t,a)=>{let n=t3(t,a);tR({sentence:t,issues:n}),tk(e)};(0,s.useEffect)(()=>{let e=async()=>{let e=tY("token"),a=tY("userId");if(e&&a)try{var n;let s=await u.A.get("".concat(t,"/friend/friends?userId=").concat(a),{headers:{Authorization:"Bearer ".concat(e)}});tE((null===(n=s.data)||void 0===n?void 0:n.friends)||[])}catch(e){console.error("friends error",e)}};ee&&e()},[t,ee]);let ar=async e=>{if(!k)return alert("No chat ID");let a=tY("token");try{let n=await u.A.post("".concat(t,"/chats/").concat(k,"/invite"),{friendId:e},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)}});200===n.status?(alert(i("friend_invited")),et(!1)):alert(i("friend_invite_failed"))}catch(e){console.error(e),alert(i("friend_invite_failed"))}},ai=async()=>{if(x)try{eo(!0);let e=tY("token");if(!e)return ed(!0);let a=await u.A.get("".concat(t,"/buddy-groups/get/").concat(x),{headers:{Authorization:"Bearer ".concat(e)}});ei(a.data)}catch(e){console.error("buddy detail err",e)}finally{eo(!1),en(!0)}},al=async()=>{if(!k)return alert("No chat ID found.");try{let e=tY("token");if(!e)return ed(!0);let a=await u.A.delete("".concat(t,"/chats/").concat(k,"/delete"),{headers:{Authorization:"Bearer ".concat(e)}});200===a.status?(alert(i("chat_deleted")),o.back()):alert(i("chat_delete_failed"))}catch(e){console.error(e),alert(i("chat_delete_failed"))}},ao=async()=>{if(k)try{let{token:e}=await tK();if(!e)return;await u.A.delete("".concat(t,"/ai-chat/session/").concat(k),{headers:{Authorization:"Bearer ".concat(e)}}),alert(i("leave_custom_session_success")),o.back()}catch(e){console.error(e),alert(i("leave_custom_session_error"))}},ac=e=>{let t=e.senderId===N,a=e8?"ai":x?"buddy":"normal",s=null!=x?x:null!=k?k:void 0;return(0,n.jsx)(j.A,{content:e.message,userId:e.senderId,isMine:t,timestamp:e.timestamp,profileImage:e.profileImage||"",imageUrl:e.imageUrl,isImageUploading:!!e.imageUrl&&e.isUploading,isTextUploading:!e.imageUrl&&e.isUploading,_id:e._id,messageType:a,chatContextId:s,onDelete:e=>F(t=>t.filter(t=>t._id!==e)),issues:ey[e._id||""]||[],onOpenQuiz:(e,t,a)=>{as(e,t,C(t,a))},selectedLanguage:eW,learningCEFR:eB})};return(0,n.jsxs)("div",{ref:tx,className:c().wrapper,children:[(0,n.jsxs)("header",{className:c().header,children:[(0,n.jsx)("button",{className:c().iconBtn,onClick:()=>o.back(),"aria-label":"Back",children:(0,n.jsx)("img",{src:"/image/BackIcon.png",alt:"Back",width:28,height:28})}),(0,n.jsxs)("button",{className:c().titleBtn,onClick:()=>e8?tV():x?ai():y?tV():void ef(!0),children:[(0,n.jsx)("span",{className:l()(c().title,{[c().titleGradient]:e1}),"aria-live":"polite",children:(null==R?void 0:R.type)==="group"?"".concat(T," (").concat((null==R?void 0:null===(e=R.userIds)||void 0===e?void 0:e.length)||0,")"):ta||D||(null==ti?void 0:ti.name)||""}),(0,n.jsx)("img",{src:"/image/chev-down.svg",alt:"",width:14,height:14})]}),x?(0,n.jsx)(em.A,{buddyGroupId:x,buddyPhoto:"",activityCountry:"",size:32}):(0,n.jsx)("button",{className:c().iconBtn,onClick:()=>$(!0),"aria-label":"Menu",children:(0,n.jsx)("img",{src:"/full-post-menu-icon.png",alt:"menu",width:28,height:28})})]}),e8&&!eP&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:l()(c().aiBar,{[c().aiBarExpanded]:eA}),ref:td,children:eA?(0,n.jsxs)("div",{className:c().aiExpanded,children:[(0,n.jsxs)("div",{className:c().aiExpandedHead,children:[(0,n.jsx)("span",{className:c().aiExpandedTitle,children:i("ai_options")}),(0,n.jsx)("button",{className:c().collapseBtn,onClick:()=>eM(!1),children:"–"})]}),(0,n.jsxs)("div",{className:c().row,children:[(0,n.jsxs)("span",{className:c().label,children:[i("difficulty"),":"]}),(0,n.jsx)("div",{className:c().scrollRow,children:["A1","A2","B1","B2","C1","C2"].map(e=>(0,n.jsx)("button",{className:l()(c().pill,{[c().pillActive]:eB===e}),onClick:()=>ek(e),children:e},e))})]}),(0,n.jsxs)("div",{className:c().row,children:[(0,n.jsxs)("span",{className:c().label,children:[i("topic"),":"]}),(0,n.jsx)("div",{className:c().scrollRow,children:["none","law","medicine","science","art"].map(e=>(0,n.jsx)("button",{className:l()(c().pill,{[c().pillActive]:eI===e}),onClick:()=>eR(e),children:i("topic_".concat(e))},e))})]}),(0,n.jsxs)("div",{className:c().centerRow,children:[(0,n.jsx)("button",{className:c().switchBtn,onClick:()=>eG(e=>!e),children:eD?i("disable_voice_chat"):i("enable_voice_chat")}),eD&&(0,n.jsx)("div",{className:c().voicePulse})]}),(0,n.jsxs)("div",{className:c().centerCol,children:[(0,n.jsx)("button",{className:c().switchBtn,onClick:()=>eT(e=>!e),children:eO?i("disable_roleplay"):i("enable_roleplay")}),eO&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:c().scenarioDesc,children:i("scenario_".concat(ez,"_desc"))}),(0,n.jsx)("div",{className:c().scrollRow,children:eh.map(e=>(0,n.jsx)("button",{className:l()(c().pill,{[c().pillActive]:ez===e.id}),onClick:()=>eE(e.id),children:i("scenario_".concat(e.id))},e.id))})]})]})]}):(0,n.jsxs)("div",{className:c().aiBarCollapsed,children:[e9?(0,n.jsx)("button",{className:c().aiPlus,onClick:()=>tc(!0)}):(0,n.jsx)("button",{className:c().aiPlus,onClick:()=>eM(!0),children:"AI +"}),(0,n.jsx)("div",{className:c().scenarioRow,ref:tm,children:e9?te&&(0,n.jsxs)("button",{className:c().customScenarioBtn,onClick:()=>tc(!0),children:[(0,n.jsx)("span",{className:c().customScenarioTitle,children:i("scenario")}),(0,n.jsx)("span",{className:c().customScenarioDesc,title:te,children:te})]}):(0,n.jsx)("div",{className:c().scenarioScroll,children:eh.map(e=>{let t=e7&&ez===e.id;return(0,n.jsx)("button",{className:l()(c().scenarioChip,{[c().scenarioChipSelected]:t,[c().scenarioChipDisabled]:!e7}),onClick:()=>{ez===e.id?e7?(eG(!1),eT(!1)):(eG(!0),eT(!0)):(e7||(eG(!0),eT(!0)),eE(e.id))},children:i("scenario_".concat(e.id))},e.id)})})})]})}),!eA&&!eP&&(0,n.jsx)("div",{className:c().badges,ref:th,children:(0,n.jsxs)("div",{className:c().badgeScroll,children:[(0,n.jsx)(q,{count:ej,icon:"edit-3",accent:"#F2542D"}),(0,n.jsx)(q,{count:eN,icon:"type",accent:"#D8315B"}),(0,n.jsxs)("button",{className:l()(c().langBtn,{[c().langBtnActive]:eJ}),ref:t_,onClick:()=>eY(e=>!e),children:[(0,n.jsx)(r.default,{src:_.A[eW]||"/flags/en.png",alt:eW,width:16,height:16}),(0,n.jsx)("span",{children:i("languages.".concat(eW))})]}),(0,n.jsxs)("button",{className:l()(c().smallPill,c().smallPillActive),onClick:()=>{$(!0)},children:[i("difficulty"),": ",eB]}),(0,n.jsx)("button",{className:l()(c().smallPill,{[c().smallPillActive]:e$}),onClick:()=>e0(e=>!e),children:i("toggle_auto_check")}),(0,n.jsx)("button",{className:l()(c().smallPill,{[c().smallPillActive]:eQ}),ref:tf,onClick:()=>eL(e=>!e),children:i("toggle_mcq")})]})})]}),e8&&!!eU&&eU!==i("ai-rt.banner.undefined")&&(0,n.jsx)("p",{className:c().modelStatus,children:eU}),(0,n.jsx)("div",{className:c().list,onScroll:e=>{e.currentTarget.scrollTop<80&&!Q&&U&&t1(!1)},children:(0,n.jsxs)("div",{className:c().listInner,children:[P.map(e=>(0,n.jsx)("div",{className:c().item,children:ac(e)},e._id)),X&&(0,n.jsxs)("div",{className:c().empty,children:[(0,n.jsx)(r.default,{src:"/plus-icon.png",alt:"",width:16,height:16}),(0,n.jsx)("span",{children:i("start_first_message")})]}),Q&&(0,n.jsx)("div",{className:c().loading})]})}),!eP&&(0,n.jsx)("div",{ref:tb,children:(0,n.jsx)(B,{value:tO,onChangeText:e=>tT(e),onSendMessage:e=>t9(e),isAIChat:e8,isVoiceChatMode:eD,onToggleVoiceChatMode:()=>eG(e=>!e)})}),V&&(0,n.jsx)("div",{className:c().menuOverlay,onClick:()=>$(!1),children:(0,n.jsxs)("div",{className:c().menu,onClick:e=>e.stopPropagation(),children:[!e8&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:c().menuBtn,onClick:al,children:i("leave_chat")}),y&&(0,n.jsx)("button",{className:c().menuBtn,onClick:async()=>{$(!1);let e=tY("token");if(!e)return ed(!0);try{let a="".concat(t,"/users/").concat(tP?"unblock":"block","/").concat(y),n=await u.A.post(a,{},{headers:{Authorization:"Bearer ".concat(e)}});200===n.status&&(tF(e=>!e),alert(tP?i("unblock_successfully"):i("block_successfully")))}catch(e){alert(i("server_error"))}},children:tP?i("unblock_user"):i("block_user")}),(0,n.jsx)("button",{className:c().menuBtn,onClick:()=>{$(!1),et(!0)},children:i("invite")})]}),e8&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:c().menuBadges,children:[(0,n.jsx)(q,{count:ej,icon:"edit-3",accent:"#F2542D"}),(0,n.jsx)(q,{count:eN,icon:"type",accent:"#D8315B"})]}),(0,n.jsx)("button",{className:c().menuBtn,onClick:()=>eG(e=>!e),children:eD?i("voice_record_on"):i("voice_record_off")}),(0,n.jsx)("button",{className:c().menuBtn,onClick:()=>e0(e=>!e),children:e$?i("auto_check_on"):i("auto_check_off")}),(0,n.jsx)("div",{className:c().scrollRow,children:["A1","A2","B1","B2","C1","C2"].map(e=>(0,n.jsx)("button",{className:l()(c().pill,{[c().pillActive]:eB===e}),onClick:()=>ek(e),children:e},e))}),(0,n.jsxs)("button",{className:c().menuBtn,onClick:()=>eY(e=>!e),children:[i("check_language"),": ",i("languages.".concat(eW))]}),eJ&&(0,n.jsxs)("div",{className:c().langGrid,children:[(eZ?eg:eX).map(e=>(0,n.jsxs)("button",{className:l()(c().langCell,{[c().langCellActive]:eW===e}),onClick:()=>{eH(e),eY(!1)},children:[(0,n.jsx)(r.default,{src:_.A[e]||"/flags/en.png",alt:e,width:24,height:24}),(0,n.jsx)("span",{children:i("languages.".concat(e))})]},e)),(0,n.jsx)("button",{className:c().langCell,onClick:()=>eV(e=>!e),children:eZ?"－":"＋"})]})]})]})}),(0,n.jsx)(A,{visible:ea,onClose:()=>en(!1),buddyGroupId:x||""}),eQ&&eP&&(0,n.jsx)(E,{choices:eP,onSelect:e=>{let t;let a=eP.find(e=>e.isCorrect).text;e.isCorrect||(t={error:e.text,suggestion:a,explanation:e.explanation||"",index:-1},t=t3(e.text,[t])[0]),t&&t8(e.text,a,e.explanation||""),t9({text:e.text},{skipGrammarCheck:!0,extraIssue:t}),eF(null)},onClose:()=>eF(null),onDisable:()=>{eL(!1),eF(null)}}),tB&&tI&&(0,n.jsx)("div",{className:c().quizOverlay,onClick:()=>tk(null),children:(0,n.jsx)("div",{className:c().quizCard,onClick:e=>e.stopPropagation(),children:"move"===tB?(0,n.jsx)(es,{sentence:tI.sentence,issues:tI.issues,started:!0,learnLanguage:eW,onSubmit:()=>setTimeout(()=>tk(null),3e3)}):(0,n.jsx)(eu,{sentence:tI.sentence,issues:tI.issues,started:!0,learnLanguage:eW,onSubmit:()=>setTimeout(()=>tk(null),3e3)})})}),(0,n.jsx)(Z,{visible:to,imageUri:ts||"",scenarioText:te||"",persona:ti||void 0,onClose:()=>tc(!1),onLeave:ao,onShare:async()=>{if(!te||!ts)return alert(i("nothing_to_share"));let e=tY("token");if(!e)return ed(!0);try{let a=(await u.A.get("".concat(t,"/users/me"),{headers:{Authorization:"Bearer ".concat(e)}})).data,n=new FormData;n.append("userId",a.userId),n.append("author",a.nickname||a.userId),n.append("time",new Date().toISOString()),n.append("category","language_study"),n.append("title",ta?"".concat(ta," - ").concat(i("shared_scenario")):i("shared_scenario")),n.append("content",te),n.append("isOffline","false"),n.append("recruitmentCount","1"),n.append("visitors","0"),n.append("likes","0"),n.append("comments","0"),n.append("language",eW),n.append("meetingTime",new Date().toISOString()),n.append("commentsOption","all"),n.append("sameCountryOnly","false"),n.append("image",new File([],"scenario.jpg",{type:"image/jpeg"}));let s=await u.A.post("".concat(t,"/posts/create"),n,{headers:{Authorization:"Bearer ".concat(e)}});s.status>=200&&s.status<300&&alert(i("post_saved_successfully"))}catch(e){console.error(e),alert((null==e?void 0:e.message)||i("unknown_error"))}},chatId:k||""}),(0,n.jsx)(G,{visible:ee,onClose:()=>et(!1),friends:tz,chatUserIds:(null==R?void 0:R.userIds)||[],onInvite:ar,underDevelopment:a}),(0,n.jsx)(Y,{visible:tw&&t2.length>0,steps:t2,storageKey:tS,onClose:()=>tN(!1)})]})}function ef(){return(0,n.jsx)(s.Suspense,{fallback:null,children:(0,n.jsx)(ev,{})})}},48335:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n={en:"/assets/flags/uk-flag.png",es:"/assets/flags/spain-flag.png",zh:"/assets/flags/china-flag.png",hi:"/assets/flags/india-flag.png",fr:"/assets/flags/france-flag.png",ko:"/assets/flags/south-korea-flag.png",ja:"/assets/flags/japan-flag.png",de:"/assets/flags/germany-flag.png",ar:"/assets/flags/saudi-arabia-flag.png",pt:"/assets/flags/portugal-flag.png",ru:"/assets/flags/russia-flag.png",it:"/assets/flags/italy-flag.png",tr:"/assets/flags/turkey-flag.png",nl:"/assets/flags/netherlands-flag.png",pl:"/assets/flags/poland-flag.png",th:"/assets/flags/thailand-flag.png",vi:"/assets/flags/vietnam-flag.png",ms:"/assets/flags/malaysia-flag.png",sv:"/assets/flags/sweden-flag.png",no:"/assets/flags/norway-flag.png",fi:"/assets/flags/finland-flag.png",el:"/assets/flags/greece-flag.png",hu:"/assets/flags/hungary-flag.png",cs:"/assets/flags/czech-republic-flag.png",ro:"/assets/flags/romania-flag.png",da:"/assets/flags/denmark-flag.png",he:"/assets/flags/israel-flag.png",id:"/assets/flags/indonesia-flag.png",uk:"/assets/flags/ukraine-flag.png",fa:"/assets/flags/iran-flag.png",bn:"/assets/flags/bangladesh-flag.png"}},50246:e=>{e.exports={container:"BuddyProfileWithFlag_container__A1ueJ",profileImage:"BuddyProfileWithFlag_profileImage__prUCO",flagWrapper:"BuddyProfileWithFlag_flagWrapper__UMv1Y",flagImage:"BuddyProfileWithFlag_flagImage__yXy_D"}},51012:e=>{e.exports={iconBtn:"MessageInputFormAI_iconBtn__tnBdg",iconPlaceholder:"MessageInputFormAI_iconPlaceholder__A2KWS",hiddenFile:"MessageInputFormAI_hiddenFile__Pyn_L",frame:"MessageInputFormAI_frame__QjYK9",input:"MessageInputFormAI_input__14hle",sending:"MessageInputFormAI_sending__FM4X3",pulse:"MessageInputFormAI_pulse__2ZsKk",previewOverlay:"MessageInputFormAI_previewOverlay__JRD91",previewCard:"MessageInputFormAI_previewCard__g84iy",previewClose:"MessageInputFormAI_previewClose__90ROs"}},51526:(e,t,a)=>{Promise.resolve().then(a.bind(a,39627))},88440:e=>{e.exports={container:"GramIsleBadge_container__J7odn",pulse:"GramIsleBadge_pulse__yDXtr","pulse-bounce":"GramIsleBadge_pulse-bounce__c8Ha5",count:"GramIsleBadge_count__fRZsZ"}},98232:e=>{e.exports={wrapper:"ChattingRoom_wrapper__Xv7a_",header:"ChattingRoom_header__1rFRa",iconBtn:"ChattingRoom_iconBtn__BQmAv",titleBtn:"ChattingRoom_titleBtn__Xvw9e",title:"ChattingRoom_title__BkCNN",titleGradient:"ChattingRoom_titleGradient__MBNeh",modelStatus:"ChattingRoom_modelStatus__zvdRq",aiBar:"ChattingRoom_aiBar__AkwI7",aiBarExpanded:"ChattingRoom_aiBarExpanded__guQyZ",aiBarCollapsed:"ChattingRoom_aiBarCollapsed__sDcJA",aiPlus:"ChattingRoom_aiPlus__umVPY",scenarioRow:"ChattingRoom_scenarioRow__enXIC",scenarioScroll:"ChattingRoom_scenarioScroll__gEPLt",scenarioChip:"ChattingRoom_scenarioChip__zlGLu",scenarioChipSelected:"ChattingRoom_scenarioChipSelected__9a_1c",scenarioChipDisabled:"ChattingRoom_scenarioChipDisabled__kQnL8",customScenarioBtn:"ChattingRoom_customScenarioBtn___5syy",customScenarioTitle:"ChattingRoom_customScenarioTitle__UAh1R",customScenarioDesc:"ChattingRoom_customScenarioDesc__yP9UE",aiExpanded:"ChattingRoom_aiExpanded___J_kS",aiExpandedHead:"ChattingRoom_aiExpandedHead__ZqDol",aiExpandedTitle:"ChattingRoom_aiExpandedTitle__uuba6",collapseBtn:"ChattingRoom_collapseBtn__sz7h3",row:"ChattingRoom_row__XHr_y",label:"ChattingRoom_label__B33dq",scrollRow:"ChattingRoom_scrollRow__tR_tv",pill:"ChattingRoom_pill__e1w1_",pillActive:"ChattingRoom_pillActive__vciRh",centerRow:"ChattingRoom_centerRow__fJ9Yk",centerCol:"ChattingRoom_centerCol__E_1Gi",switchBtn:"ChattingRoom_switchBtn__4dOiO",voicePulse:"ChattingRoom_voicePulse__Tq1_i",pulse:"ChattingRoom_pulse__1pPOh",badges:"ChattingRoom_badges__lkCLp",badgeScroll:"ChattingRoom_badgeScroll__7JbnH",langBtn:"ChattingRoom_langBtn__2Cp6y",langBtnActive:"ChattingRoom_langBtnActive__zgvis",smallPill:"ChattingRoom_smallPill__5GDq7",smallPillActive:"ChattingRoom_smallPillActive__dmHhp",list:"ChattingRoom_list__l9_dC",listInner:"ChattingRoom_listInner__xbqFC",item:"ChattingRoom_item__6um4C",empty:"ChattingRoom_empty__qAaDt",loading:"ChattingRoom_loading__lysoW",menuOverlay:"ChattingRoom_menuOverlay__6uO6j",menu:"ChattingRoom_menu__nA7sp",menuBtn:"ChattingRoom_menuBtn__CTNU2",menuBadges:"ChattingRoom_menuBadges__Ib0Z3",langGrid:"ChattingRoom_langGrid__zALoz",langCell:"ChattingRoom_langCell__iREg8",langCellActive:"ChattingRoom_langCellActive__QjAE6",quizOverlay:"ChattingRoom_quizOverlay__5FRRM",quizCard:"ChattingRoom_quizCard__HiiMM"}}},e=>{var t=t=>e(e.s=t);e.O(0,[6407,5038,9066,844,8568,3464,1218,8152,2320,8723,493,8441,1684,7358],()=>t(51526)),_N_E=e.O()}]);